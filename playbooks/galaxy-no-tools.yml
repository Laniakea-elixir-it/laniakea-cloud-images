---
- name: Apply Galaxy Role
  hosts: localhost
  connection: local
  vars:
    galaxy_version: "<galaxy_version>"
  roles:
    - role: indigo-dc.galaxycloud
      create_galaxy_admin: false
      GALAXY_VERSION: '{{ galaxy_version }}'
      create_galaxy_admin: false
      set_pgsql_random_password: false
      set_proftpd_random_password: false
      require_login: 'False' # disable login option only for galaxy images

- name: Post installation tasks
  hosts: localhost
  connection: local
  vars:
    galaxy_user: "galaxy"
    galaxy_instance_key_pub: "<ssh_pub_key>"
  tasks:
    - name: 'Remove galaxy ssh public key'
      authorized_key:
        user: '{{ galaxy_user }}'
        key: '{{ galaxy_instance_key_pub }}'
        state: absent
    - name: 'Remove root ssh public key' # needed by IM
      authorized_key:
        user: 'root'
        key: '{{ galaxy_instance_key_pub }}'
        state: absent
